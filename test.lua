local base64 = require('gamesense/base64')
local ffi = require("ffi")
local http = require("gamesense/http")
local hwid_valid = false
local function check_loader_environment()
    if _G["LOADER_ENV"] ~= true or _G["LOADER_ID"] ~= "unique_loader_identifier_12345" then
        print("joker xaxaxa")
        return false
    end
    return true
end
local pastebin_hwid_url = "https://pastebin.com/015e95ac"


print("Loader HWID: " .. HWID)  -- 打印从加载器传递的 HWID
local function get_hwids_from_pastebin()
    http.get(pastebin_hwid_url, function(success, response)
        if not success then
            return
        end
        local hwids = response.body

        if hwids:find(current_hwid) then
            hwid_valid = true
        else
            hwid_valid = false
        end
    end)
end
get_hwids_from_pastebin()
if check_loader_environment() and hwid_valid then
    local base64_string = "bG9jYWwgbWVudSA9IHsKCXRvcF9tZXNzYWdlID0gdWkubmV3X2xhYmVsKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiLS0tLS0tLS0tIFBoYW50b20gWWF3IC0tLS0tLS0tLSIpLAoJbWFpbl9hYSA9IHVpLm5ld19jaGVja2JveCgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkVuYWJsZSBBbnRpLUFpbSIpLAoJYW50aWFpbV95YXcgPSB1aS5uZXdfY29tYm9ib3goIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJBbnRpLUFpbSBZYXciLCAiRGFuZ2Vyb3VzIiwgIkh5YnJpZCIpLAoJYW50aWFpbV9vcHRpb25zID0gdWkubmV3X2NvbWJvYm94KCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQW50aS1BaW0gYmFzZWQgb2YiLCAiRW5lbXkgTGV0aGFsIiksCiAgICBhbnRpYWltX3Nob3QgPSB1aS5uZXdfY2hlY2tib3goIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJDZW50ZXIgaml0dGVyIG9uLXNob3QiKSwKfQoKbG9jYWwgYnJ1dGUgPSB7CiAgICB5YXdfc3RhdHVzID0gImRlZmF1bHQiLAogICAgaW5kZXhlZF9hbmdsZSA9IDAsCiAgICBsYXN0X21pc3MgPSAwLAogICAgYmVzdF9hbmdsZSA9IDAsCiAgICBtaXNzZXMgPSB7IH0sIC0tdGhpcyBpcyBlaXRoZXIgbmlsLCAxIG9yIDIKICAgIGhpdF9yZXZlcnNlID0geyB9Cn0KCmxvY2FsIHNob3QgPSB7CiAgICBkaWRfc2hvb3QgPSBmYWxzZSwKICAgIGRlbGF5ID0gMCwKfQoKbG9jYWwgYmVzdF9lbmVteSA9IG5pbAoKbG9jYWwgYWFfbWFpbiA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkVuYWJsZWQiKQpsb2NhbCBhYV9waXRjaCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIlBpdGNoIikKbG9jYWwgYWFfeWF3LCBhYV95YXdfb2Zmc2V0ID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiWWF3IikKbG9jYWwgYWFfeWF3X2ppdHRlciwgYWFfeWF3X2ppdHRlcl9vZmZzZXQ9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBqaXR0ZXIiKQpsb2NhbCBhYV95YXdfYmFzZSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBiYXNlIikKbG9jYWwgYWFfYm9keV95YXcsIGFhX2JvZHlfeWF3X29mZnNldD0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiQm9keSB5YXciKQpsb2NhbCBhYV9mcmVlc3RhbmRfYm9keSA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkZyZWVzdGFuZGluZyBib2R5IHlhdyIpCgp1aS5zZXRfdmlzaWJsZShhYV9tYWluLGZhbHNlKQp1aS5zZXRfdmlzaWJsZShhYV95YXcsZmFsc2UpCnVpLnNldF92aXNpYmxlKGFhX3lhd19vZmZzZXQsZmFsc2UpCnVpLnNldF92aXNpYmxlKGFhX3BpdGNoLGZhbHNlKQp1aS5zZXRfdmlzaWJsZShhYV95YXdfaml0dGVyLGZhbHNlKQp1aS5zZXRfdmlzaWJsZShhYV95YXdfaml0dGVyX29mZnNldCxmYWxzZSkKdWkuc2V0X3Zpc2libGUoYWFfeWF3X2Jhc2UsZmFsc2UpCnVpLnNldF92aXNpYmxlKGFhX2JvZHlfeWF3LGZhbHNlKQp1aS5zZXRfdmlzaWJsZShhYV9ib2R5X3lhd19vZmZzZXQsZmFsc2UpCnVpLnNldF92aXNpYmxlKGFhX2ZyZWVzdGFuZF9ib2R5LGZhbHNlKQppZiB1aS5nZXQobWVudS5tYWluX2FhKSB0aGVuCiAgICBhYV9tYWluPXRydWUKZW5kCgpsb2NhbCBmdW5jdGlvbiBleHRyYXBvbGF0ZV9wb3NpdGlvbih4cG9zLHlwb3MsenBvcyx0aWNrcyxlbnQpCgl4LHkseiA9IGVudGl0eS5nZXRfcHJvcChlbnQsICJtX3ZlY1ZlbG9jaXR5IikKCWZvciBpPTAsIHRpY2tzIGRvCgkJeHBvcyA9ICB4cG9zICsgKHgqZ2xvYmFscy50aWNraW50ZXJ2YWwoKSkKCQl5cG9zID0gIHlwb3MgKyAoeSpnbG9iYWxzLnRpY2tpbnRlcnZhbCgpKQoJCXpwb3MgPSAgenBvcyArICh6Kmdsb2JhbHMudGlja2ludGVydmFsKCkpCgllbmQKCXJldHVybiB4cG9zLHlwb3MsenBvcwplbmQKCmxvY2FsIGZ1bmN0aW9uIG5vcm1hbGl6ZV95YXcoeWF3KQoJd2hpbGUgeWF3ID4gMTgwIGRvIHlhdyA9IHlhdyAtIDM2MCBlbmQKCXdoaWxlIHlhdyA8IC0xODAgZG8geWF3ID0geWF3ICsgMzYwIGVuZAoJcmV0dXJuIHlhdwplbmQKCmxvY2FsIGZ1bmN0aW9uIGFuZ19vbl9zY3JlZW4oeCwgeSkKICAgIGlmIHggPT0gMCBhbmQgeSA9PSAwIHRoZW4gcmV0dXJuIDAgZW5kCgogICAgcmV0dXJuIG1hdGguZGVnKG1hdGguYXRhbjIoeSwgeCkpCmVuZAoKbG9jYWwgZnVuY3Rpb24gQW5nbGVfVmVjdG9yKGFuZ2xlX3gsIGFuZ2xlX3kpCiAgICBsb2NhbCBzcCwgc3ksIGNwLCBjeSA9IG5pbAogICAgc3kgPSBtYXRoLnNpbihtYXRoLnJhZChhbmdsZV95KSk7CiAgICBjeSA9IG1hdGguY29zKG1hdGgucmFkKGFuZ2xlX3kpKTsKICAgIHNwID0gbWF0aC5zaW4obWF0aC5yYWQoYW5nbGVfeCkpOwogICAgY3AgPSBtYXRoLmNvcyhtYXRoLnJhZChhbmdsZV94KSk7CiAgICByZXR1cm4gY3AgKiBjeSwgY3AgKiBzeSwgLXNwOwplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldF92ZWxvY2l0eShwbGF5ZXIpCiAgICBsb2NhbCB4LHkseiA9IGVudGl0eS5nZXRfcHJvcChwbGF5ZXIsICJtX3ZlY1ZlbG9jaXR5IikKICAgIGlmIHggPT0gbmlsIHRoZW4gcmV0dXJuIGVuZAogICAgcmV0dXJuIG1hdGguc3FydCh4KnggKyB5KnkgKyB6KnopCmVuZAoKbG9jYWwgdmVjXzMgPSBmdW5jdGlvbihfeCwgX3ksIF96KSAKCXJldHVybiB7IHggPSBfeCBvciAwLCB5ID0gX3kgb3IgMCwgeiA9IF96IG9yIDAgfSAKZW5kCgpsb2NhbCBmdW5jdGlvbiBDYWxjQW5nbGUobG9jYWxwbGF5ZXJ4cG9zLCBsb2NhbHBsYXllcnlwb3MsIGVuZW15eHBvcywgZW5lbXl5cG9zKQogICBsb2NhbCByZWxhdGl2ZXlhdyA9IG1hdGguYXRhbiggKGxvY2FscGxheWVyeXBvcyAtIGVuZW15eXBvcykgLyAobG9jYWxwbGF5ZXJ4cG9zIC0gZW5lbXl4cG9zKSApCiAgICByZXR1cm4gcmVsYXRpdmV5YXcgKiAxODAgLyBtYXRoLnBpCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0X2Jlc3RfZW5lbXkoKQogICAgLS0gV2Ugc3RvcmUgdGhlIGJlc3QgdGFyZ2V0IGluIGEgZ2xvYmFsIHZhcmlhYmxlIHNvIHdlIGRvbid0IGhhdmUgdG8gcmUgcnVuIHRoZSBjYWxjdWxhdGlvbnMgZXZlcnkgdGltZSB3ZSB3YW50IHRvIGZpbmQgdGhlIGJlc3QgdGFyZ2V0LgogICAgYmVzdF9lbmVteSA9IG5pbAoKICAgIGxvY2FsIGVuZW1pZXMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkKICAgIGxvY2FsIGJlc3RfZm92ID0gMTgwCgogICAgbG9jYWwgbHgsIGx5LCBseiA9IGNsaWVudC5leWVfcG9zaXRpb24oKQogICAgbG9jYWwgdmlld194LCB2aWV3X3ksIHJvbGwgPSBjbGllbnQuY2FtZXJhX2FuZ2xlcygpCiAgICAKICAgIGZvciBpPTEsICNlbmVtaWVzIGRvCiAgICAgICAgbG9jYWwgY3VyX3gsIGN1cl95LCBjdXJfeiA9IGVudGl0eS5nZXRfcHJvcChlbmVtaWVzW2ldLCAibV92ZWNPcmlnaW4iKQogICAgICAgIGxvY2FsIGN1cl9mb3YgPSBtYXRoLmFicyhub3JtYWxpemVfeWF3KGFuZ19vbl9zY3JlZW4obHggLSBjdXJfeCwgbHkgLSBjdXJfeSkgLSB2aWV3X3kgKyAxODApKQogICAgICAgIGlmIGN1cl9mb3YgPCBiZXN0X2ZvdiB0aGVuCgkJCWJlc3RfZm92ID0gY3VyX2ZvdgoJCQliZXN0X2VuZW15ID0gZW5lbWllc1tpXQoJCWVuZAogICAgZW5kCmVuZAoKCgpicnV0ZS5pbXBhY3QgPSBmdW5jdGlvbihlKQogICAgaWYgbm90IHVpLmdldChtZW51Lm1haW5fYWEpIHRoZW4gcmV0dXJuIGVuZAoKICAgIGxvY2FsIG1lID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQoKICAgIC0tIFNpbmNlIGJ1bGxldF9pbXBhY3QgZ2V0cyB0cmlnZ2VyZWQgZXZlbiB3aGlsZSB3ZSdyZSBkZWFkIGhhdmluZyB0aGlzIGNoZWNrIGlzIGEgZ29vZCBpZGVhLgogICAgaWYgbm90IGVudGl0eS5pc19hbGl2ZShtZSkgdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgc2hvb3Rlcl9pZCA9IGUudXNlcmlkCiAgICBsb2NhbCBzaG9vdGVyID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleChzaG9vdGVyX2lkKQoKICAgIC0tIERpc3RhbmNlIGNhbGN1bGF0aW9ucyBjYW4gc29tZXRpbWVzIGJ1ZyB3aGVuIHRoZSBlbnRpdHkgaXMgZG9ybWFudCBoZW5jZSB0aGUgMm5kIGNoZWNrLgogICAgaWYgbm90IGVudGl0eS5pc19lbmVteShzaG9vdGVyKSBvciBlbnRpdHkuaXNfZG9ybWFudChzaG9vdGVyKSB0aGVuIHJldHVybiBlbmQKCiAgICBsb2NhbCBseCwgbHksIGx6ID0gZW50aXR5LmhpdGJveF9wb3NpdGlvbihtZSwgImhlYWRfMCIpCiAgICAKCWxvY2FsIG94LCBveSwgb3ogPSBlbnRpdHkuZ2V0X3Byb3AobWUsICJtX3ZlY09yaWdpbiIpCiAgICBsb2NhbCBleCwgZXksIGV6ID0gZW50aXR5LmdldF9wcm9wKHNob290ZXIsICJtX3ZlY09yaWdpbiIpCgogICAgbG9jYWwgZGlzdCA9ICgoZS55IC0gZXkpKmx4IC0gKGUueCAtIGV4KSpseSArIGUueCpleSAtIGUueSpleCkgLyBtYXRoLnNxcnQoKGUueS1leSleMiArIChlLnggLSBleCleMikKICAgIAogICAgLS0gMzIgaXMgb3VyIG1pc3MgZGV0ZWN0aW9uIHJhZGl1cyBhbmQgdGhlIDJuZCBjaGVjayBpcyB0byBhdm9pZCBhZGRpbmcgbW9yZSB0aGFuIDEgbWlzcyBmb3IgYSBzaW5ndWxhciBidWxsZXQgKGJ1bGxldF9pbXBhY3QgZ2V0cyBjYWxsZWQgbXVsaXRwbGUgdGltZXMgcGVyIHNob3QpLgogICAgaWYgbWF0aC5hYnMoZGlzdCkgPD0gMzIgYW5kIGdsb2JhbHMuY3VydGltZSgpIC0gYnJ1dGUubGFzdF9taXNzID4gMC4wMTUgdGhlbgogICAgICAgIGJydXRlLmxhc3RfbWlzcyA9IGdsb2JhbHMuY3VydGltZSgpCiAgICAgICAgaWYgYnJ1dGUubWlzc2VzW3Nob290ZXJdID09IG5pbCB0aGVuCiAgICAgICAgICAgIGJydXRlLm1pc3Nlc1tzaG9vdGVyXSA9IDEgCiAgICAgICAgZWxzZWlmIGJydXRlLm1pc3Nlc1tzaG9vdGVyXSA+PSAyIHRoZW4KICAgICAgICAgICAgYnJ1dGUubWlzc2VzW3Nob290ZXJdID0gbmlsCiAgICAgICAgZWxzZQogICAgICAgICAgICBicnV0ZS5taXNzZXNbc2hvb3Rlcl0gPSBicnV0ZS5taXNzZXNbc2hvb3Rlcl0gKyAxCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKYnJ1dGUuZGVhdGggPSBmdW5jdGlvbihlKQogICAgaWYgbm90IHVpLmdldChtZW51Lm1haW5fYWEpIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBsb2NhbCB2aWN0aW1faWQgPSBlLnVzZXJpZAogICAgbG9jYWwgdmljdGltID0gY2xpZW50LnVzZXJpZF90b19lbnRpbmRleCh2aWN0aW1faWQpCgogICAgaWYgdmljdGltIH49IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgdGhlbiByZXR1cm4gZW5kCgogICAgbG9jYWwgYXR0YWNrZXJfaWQgPSBlLmF0dGFja2VyCiAgICBsb2NhbCBhdHRhY2tlciA9IGNsaWVudC51c2VyaWRfdG9fZW50aW5kZXgoYXR0YWNrZXJfaWQpCgogICAgaWYgbm90IGVudGl0eS5pc19lbmVteShhdHRhY2tlcikgdGhlbiByZXR1cm4gZW5kCgogICAgaWYgbm90IGUuaGVhZHNob3QgdGhlbiByZXR1cm4gZW5kCgogICAgaWYgYnJ1dGUubWlzc2VzW2F0dGFja2VyXSA9PSBuaWwgb3IgKGdsb2JhbHMuY3VydGltZSgpIC0gYnJ1dGUubGFzdF9taXNzIDwgMC4wNiBhbmQgYnJ1dGUubWlzc2VzW2F0dGFja2VyXSA9PSAxKSB0aGVuCiAgICAgICAgaWYgYnJ1dGUuaGl0X3JldmVyc2VbYXR0YWNrZXJdID09IG5pbCB0aGVuCiAgICAgICAgICAgIGJydXRlLmhpdF9yZXZlcnNlW2F0dGFja2VyXSA9IHRydWUKICAgICAgICBlbHNlCiAgICAgICAgICAgIGJydXRlLmhpdF9yZXZlcnNlW2F0dGFja2VyXSA9IG5pbAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0gQUxMIERZTkFNSUMgQUEgRlVOQ1RJT05TCi0tIG5vcm1hbCBGcmVlc3RhbmRpbmcKbG9jYWwgZnVuY3Rpb24gRG9GcmVlc3RhbmRpbmcoZW5lbXksIC4uLikKICAgIGxvY2FsIGx4LCBseSwgbHogPSBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fdmVjT3JpZ2luIikKICAgIGxvY2FsIHZpZXdhbmdsZV94LCB2aWV3YW5nbGVfeSwgcm9sbCA9IGNsaWVudC5jYW1lcmFfYW5nbGVzKCkKICAgIGxvY2FsIGhlYWR4LCBoZWFkeSwgaGVhZHogPSBlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksIDApCiAgICBsb2NhbCBlbmVteXgsIGVuZW15eSwgZW5lbXl6ID0gZW50aXR5LmdldF9wcm9wKGVuZW15LCAibV92ZWNPcmlnaW4iKQogICAgbG9jYWwgYmVzdGFuZ2xlID0gbmlsCiAgICBsb2NhbCBsb3dlc3RfZG1nID0gbWF0aC5odWdlCgogICAgaWYoZW50aXR5LmlzX2FsaXZlKGVuZW15KSkgdGhlbgogICAgICAgIGxvY2FsIHlhdyA9IENhbGNBbmdsZShseCwgbHksIGVuZW15eCwgZW5lbXl5KQogICAgICAgIGZvciBpLHYgaW4gcGFpcnMoey4uLn0pIGRvCiAgICAgICAgICAgIGxvY2FsIGRpcl94LCBkaXJfeSwgZGlyX3ogPSBBbmdsZV9WZWN0b3IoMCwgKHlhdyArIHYpKQogICAgICAgICAgICBsb2NhbCBlbmRfeCA9IGx4ICsgZGlyX3ggKiA1NQogICAgICAgICAgICBsb2NhbCBlbmRfeSA9IGx5ICsgZGlyX3kgKiA1NQogICAgICAgICAgICBsb2NhbCBlbmRfeiA9IGx6ICsgODAgICAgICAgICAgIAogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgaW5kZXgsIGRhbWFnZSA9IGNsaWVudC50cmFjZV9idWxsZXQoZW5lbXksIGVuZW15eCwgZW5lbXl5LCBlbmVteXogKyA3MCwgZW5kX3gsIGVuZF95LCBlbmRfeix0cnVlKQogICAgICAgICAgICBsb2NhbCBpbmRleDIsIGRhbWFnZTIgPSBjbGllbnQudHJhY2VfYnVsbGV0KGVuZW15LCBlbmVteXgsIGVuZW15eSwgZW5lbXl6ICsgNzAsIGVuZF94ICsgMTIsIGVuZF95LCBlbmRfeix0cnVlKSAtLXRlc3QKICAgICAgICAgICAgbG9jYWwgaW5kZXgzLCBkYW1hZ2UzID0gY2xpZW50LnRyYWNlX2J1bGxldChlbmVteSwgZW5lbXl4LCBlbmVteXksIGVuZW15eiArIDcwLCBlbmRfeCAtIDEyLCBlbmRfeSwgZW5kX3osdHJ1ZSkgLS10ZXN0CgogICAgICAgICAgICBpZihkYW1hZ2UgPCBsb3dlc3RfZG1nKSB0aGVuCiAgICAgICAgICAgICAgICBsb3dlc3RfZG1nID0gZGFtYWdlCiAgICAgICAgICAgICAgICBpZihkYW1hZ2UyID4gZGFtYWdlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG93ZXN0X2RtZyA9IGRhbWFnZTIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYoZGFtYWdlMyA+IGRhbWFnZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvd2VzdF9kbWcgPSBkYW1hZ2UzCiAgICAgICAgICAgICAgICBlbmQgCiAgICAgICAgICAgICAgICBpZihseCAtIGVuZW15eCA+IDApIHRoZW4KICAgICAgICAgICAgICAgICAgICBiZXN0YW5nbGUgPSB2CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYmVzdGFuZ2xlID0gdiAqIC0xCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZWlmKGRhbWFnZSA9PSBsb3dlc3RfZG1nKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBiZXN0YW5nbGUKZW5kCi0tIHNlY29uZGFyeSBGcmVlc3RhbmRpbmcgKHRvIG1ha2UgaXQga2ljayBpbiBtb3JlLCB1c2VkIHdoZW4gdGhlIG5vcm1hbCBmdW5jdGlvbiBmaW5kcyBubyBhbmdsZSkKbG9jYWwgZnVuY3Rpb24gRG9FYXJseUZyZWVzdGFuZGluZyhlbmVteSwgLi4uKQogICAgLS1pZiBzdG9yZWRfZnJlZXN0YW5kID09IDkwIG9yIHN0b3JlZF9mcmVlc3RhbmQgPT0gLTkwIHRoZW4gcmV0dXJuIGVuZAogICAgLS0gQ0hJTkEgQUxFUlQKICAgIGxvY2FsIGx4LCBseSwgbHogPSBlbnRpdHkuZ2V0X3Byb3AoZW5lbXksICJtX3ZlY09yaWdpbiIpIC0tIHRvCiAgICBsb2NhbCB2aWV3YW5nbGVfeCwgdmlld2FuZ2xlX3ksIHJvbGwgPSBjbGllbnQuY2FtZXJhX2FuZ2xlcygpCiAgICBsb2NhbCBsb2NhbHBsYXllciA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkKICAgIGxvY2FsIGhlYWR4LCBoZWFkeSwgaGVhZHogPSBlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKGxvY2FscGxheWVyLCAwKQogICAgbG9jYWwgZW5lbXl4LCBlbmVteXksIGVuZW15eiA9IGVudGl0eS5nZXRfcHJvcChsb2NhbHBsYXllciwgIm1fdmVjT3JpZ2luIikgLS0gZnJvbQogICAgbG9jYWwgYmVzdGFuZ2xlID0gbmlsCiAgICBsb2NhbCBsb3dlc3RfZG1nID0gbWF0aC5odWdlCiAgICBsb2NhbCBsYXN0X21vdmVkID0gMAogICAgbG9jYWwgZnNfc3RvcmVkX2V5ZXBvc194LCBmc19zdG9yZWRfZXllcG9zX3ksIGZzX3N0b3JlZF9leWVwb3NfeiA9IG5pbAogICAgLS0gSSBET05UIEVWRU4gS05PVyBXSFkgVEhJUyBXT1JLUwogICAgaWYoZW50aXR5LmlzX2FsaXZlKGVuZW15KSkgdGhlbgogICAgICAgIGxvY2FsIHlhdyA9IENhbGNBbmdsZShlbmVteXgsIGVuZW15eSwgbHgsIGx5KQogICAgICAgIGZvciBpLHYgaW4gcGFpcnMoey4uLn0pIGRvCiAgICAgICAgICAgIGxvY2FsIGRpcl94LCBkaXJfeSwgZGlyX3ogPSBBbmdsZV9WZWN0b3IoMCwgKHlhdyArIHYpKQogICAgICAgICAgICBsb2NhbCBlbmRfeCA9IGx4ICsgZGlyX3ggKiA1NQogICAgICAgICAgICBsb2NhbCBlbmRfeSA9IGx5ICsgZGlyX3kgKiA1NQogICAgICAgICAgICBsb2NhbCBlbmRfeiA9IGx6ICsgODAKICAgICAgICAgICAgLS0gRVhUUkFQT0xBVEUKICAgICAgICAgICAgbG9jYWwgZXllcG9zX3gsIGV5ZXBvc195LCBleWVwb3NfeiA9IGNsaWVudC5leWVfcG9zaXRpb24oKQogICAgICAgICAgICBsb2NhbCBsb2NhbF92ZWxvY2l0eSA9IGdldF92ZWxvY2l0eShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKQogICAgICAgICAgICBsb2NhbCBjYW5fYmVfZXh0cmFwb2xhdGVkID0gbG9jYWxfdmVsb2NpdHkgPiAxNQogICAgICAgICAgICBsb2NhbCB0aWNrc190b19leHRyYXBvbGF0ZSA9IDExCiAgICAgICAgICAgIGlmIChsb2NhbF92ZWxvY2l0eSA8IDUwKSB0aGVuCiAgICAgICAgICAgICAgICB0aWNrc190b19leHRyYXBvbGF0ZSA9IDkwCiAgICAgICAgICAgIGVsc2VpZiAobG9jYWxfdmVsb2NpdHkgPj0gNTAgYW5kIGxvY2FsX3ZlbG9jaXR5IDwgMTIwKSB0aGVuCiAgICAgICAgICAgICAgICB0aWNrc190b19leHRyYXBvbGF0ZSA9IDUwCiAgICAgICAgICAgIGVsc2VpZiAobG9jYWxfdmVsb2NpdHkgPj0gMTIwIGFuZCBsb2NhbF92ZWxvY2l0eSA8IDE5MCkgdGhlbgogICAgICAgICAgICAgICAgdGlja3NfdG9fZXh0cmFwb2xhdGUgPSA0MAogICAgICAgICAgICBlbHNlaWYgKGxvY2FsX3ZlbG9jaXR5ID49IDE5MCkgdGhlbgogICAgICAgICAgICAgICAgdGlja3NfdG9fZXh0cmFwb2xhdGUgPSAyMAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIGNhbl9iZV9leHRyYXBvbGF0ZWQgdGhlbgogICAgICAgICAgICAgICAgZXllcG9zX3gsIGV5ZXBvc195LCBleWVwb3NfeiA9IGV4dHJhcG9sYXRlX3Bvc2l0aW9uKGV5ZXBvc194LCBleWVwb3NfeSwgZXllcG9zX3osIHRpY2tzX3RvX2V4dHJhcG9sYXRlLCBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKQogICAgICAgICAgICAgICAgZnNfc3RvcmVkX2V5ZXBvc194LCBmc19zdG9yZWRfZXllcG9zX3ksIGZzX3N0b3JlZF9leWVwb3NfeiA9IGV5ZXBvc194LCBleWVwb3NfeSwgZXllcG9zX3oKICAgICAgICAgICAgICAgIGxhc3RfbW92ZWQgPSBnbG9iYWxzLmN1cnRpbWUoKSArIDEKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgbGFzdF9tb3ZlZCB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnbG9iYWxzLmN1cnRpbWUoKSA+IGxhc3RfbW92ZWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsYXN0X21vdmVkID0gMAogICAgICAgICAgICAgICAgICAgICAgICBmc19zdG9yZWRfZXllcG9zX3gsIGZzX3N0b3JlZF9leWVwb3NfeSwgZnNfc3RvcmVkX2V5ZXBvc196ID0gbmlsCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBleWVwb3NfeCwgZXllcG9zX3ksIGV5ZXBvc196ID0gZnNfc3RvcmVkX2V5ZXBvc194LCBmc19zdG9yZWRfZXllcG9zX3ksIGZzX3N0b3JlZF9leWVwb3NfegogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGV5ZXBvc194LCBleWVwb3NfeSwgZXllcG9zX3ogPSBleHRyYXBvbGF0ZV9wb3NpdGlvbihleWVwb3NfeCwgZXllcG9zX3ksIGV5ZXBvc196LCB0aWNrc190b19leHRyYXBvbGF0ZSwgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGluZGV4LCBkYW1hZ2UgPSBjbGllbnQudHJhY2VfYnVsbGV0KGxvY2FscGxheWVyLCBlbmVteXgsIGVuZW15eSwgZW5lbXl6ICsgNzAsIGVuZF94LCBlbmRfeSwgZW5kX3osdHJ1ZSkKICAgICAgICAgICAgbG9jYWwgaW5kZXgyLCBkYW1hZ2UyID0gY2xpZW50LnRyYWNlX2J1bGxldChsb2NhbHBsYXllciwgZW5lbXl4LCBlbmVteXksIGVuZW15eiArIDcwLCBlbmRfeCArIDEyLCBlbmRfeSwgZW5kX3osdHJ1ZSkgLS10ZXN0CiAgICAgICAgICAgIGxvY2FsIGluZGV4MywgZGFtYWdlMyA9IGNsaWVudC50cmFjZV9idWxsZXQobG9jYWxwbGF5ZXIsIGVuZW15eCwgZW5lbXl5LCBlbmVteXogKyA3MCwgZW5kX3ggLSAxMiwgZW5kX3ksIGVuZF96LHRydWUpIC0tdGVzdAoKICAgICAgICAgICAgaWYgZnNfc3RvcmVkX2V5ZXBvc194IH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICBpbmRleCwgZGFtYWdlID0gY2xpZW50LnRyYWNlX2J1bGxldChsb2NhbHBsYXllciwgZnNfc3RvcmVkX2V5ZXBvc194LCBmc19zdG9yZWRfZXllcG9zX3ksIGZzX3N0b3JlZF9leWVwb3NfeiArIDcwLCBlbmRfeCwgZW5kX3ksIGVuZF96LHRydWUpCiAgICAgICAgICAgICAgICBpbmRleDIsIGRhbWFnZTIgPSBjbGllbnQudHJhY2VfYnVsbGV0KGxvY2FscGxheWVyLCBmc19zdG9yZWRfZXllcG9zX3gsIGZzX3N0b3JlZF9leWVwb3NfeSwgZnNfc3RvcmVkX2V5ZXBvc196ICsgNzAsIGVuZF94ICsgMTIsIGVuZF95LCBlbmRfeix0cnVlKSAtLXRlc3QKICAgICAgICAgICAgICAgIGluZGV4MywgZGFtYWdlMyA9IGNsaWVudC50cmFjZV9idWxsZXQobG9jYWxwbGF5ZXIsIGZzX3N0b3JlZF9leWVwb3NfeCwgZnNfc3RvcmVkX2V5ZXBvc195LCBmc19zdG9yZWRfZXllcG9zX3ogKyA3MCwgZW5kX3ggLSAxMiwgZW5kX3ksIGVuZF96LHRydWUpIC0tdGVzdAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmKGRhbWFnZSA8IGxvd2VzdF9kbWcpIHRoZW4KICAgICAgICAgICAgICAgIGxvd2VzdF9kbWcgPSBkYW1hZ2UKICAgICAgICAgICAgICAgIGlmKGRhbWFnZTIgPiBkYW1hZ2UpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb3dlc3RfZG1nID0gZGFtYWdlMgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZihkYW1hZ2UzID4gZGFtYWdlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG93ZXN0X2RtZyA9IGRhbWFnZTMKICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgIGlmKGVuZW15eCAtIGx4ID4gMCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGJlc3RhbmdsZSA9IHYKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGJlc3RhbmdsZSA9IHYgKiAtMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZihkYW1hZ2UgPT0gbG93ZXN0X2RtZykgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBiZXN0YW5nbGUKZW5kCgpsb2NhbCBmdW5jdGlvbiBlbmVteV9pc19wZWVraW5nX2FuZF9jYW5faGl0X3VzKGVudCkKICAgIGlmIGVudCA9PSBuaWwgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBvcmlnaW5feCwgb3JpZ2luX3ksIG9yaWdpbl96ID0gZW50aXR5X2dldF9wcm9wKGVudCwgIm1fdmVjT3JpZ2luIikKICAgIGxvY2FsIHZ4LHZ5LHZ6ID0gZW50aXR5X2dldF9wcm9wKGVuZW15Y2xvc2VzdHRvY3Jvc3NoYWlyLCAibV92ZWNWaWV3T2Zmc2V0IikKICAgIGlmIG9yaWdpbl96ID09IG5pbCB0aGVuIHJldHVybiBlbmQKICAgIG9yaWdpbl94LG9yaWdpbl95LG9yaWdpbl96ID0gb3JpZ2luX3grdngsb3JpZ2luX3krdnksb3JpZ2luX3ordnoKCiAgICAtLW9yaWdpbl96ID0gb3JpZ2luX3ogKyA2NAogICAgbG9jYWwgbHAgPSBlbnRpdHlfZ2V0X2xvY2FsX3BsYXllcigpCiAgICAKICAgIGlmIChnZXRfdmVsb2NpdHkoZW50KSA8IDIwKSBvciBpbl9haXIoZW50KSBvciBpbl9haXIoZW50aXR5X2dldF9sb2NhbF9wbGF5ZXIoKSkgdGhlbiByZXR1cm4gZmFsc2UgZW5kCgogICAgbG9jYWwgZXh0cmFwb2xhdGVkX3gsIGV4dHJhcG9sYXRlZF95LCBleHRyYXBvbGF0ZWRfeiA9IGV4dHJhcG9sYXRlX3Bvc2l0aW9uKG9yaWdpbl94LCBvcmlnaW5feSwgb3JpZ2luX3osIDE2LCBlbnQpCiAgICAtLW9yaWdpbl94LCBvcmlnaW5feSwgb3JpZ2luX3oKICAgIC0tCiAgICBsb2NhbCBoeCxoeSxoeiA9IGVudGl0eV9oaXRib3hfcG9zaXRpb24obHAsIDApCiAgICBsb2NhbCBseCxseSxseiA9IGNsaWVudF9leWVfcG9zaXRpb24oKQogICAgbHogPSBoegogICAgCiAgICBsb2NhbCBfLCBleWVfeWF3ID0gZW50aXR5X2dldF9wcm9wKGxwLCAibV9hbmdFeWVBbmdsZXMiKQogICAgbG9jYWwgZGVzeW5jID0gbm9ybWFsaXNlX2FuZ2xlKGV5ZV95YXcgKyAoZ2V0X2JvZHlfeWF3KGxwKSkpCiAgICBsb2NhbCByZWFsX3ggPSBseCArIG1hdGhfY29zKG1hdGhfcmFkKGRlc3luYykpICogMjAKICAgIGxvY2FsIHJlYWxfeSA9IGx5ICsgbWF0aF9zaW4obWF0aF9yYWQoZGVzeW5jKSkgKiAxMgogICAgCiAgICBsb2NhbCBkZXN5bmNlZCA9IG5vcm1hbGlzZV9hbmdsZShleWVfeWF3IC0gKGdldF9ib2R5X3lhdyhscCkpKQogICAgbG9jYWwgZmFrZV94ID0gbHggKyBtYXRoX2NvcyhtYXRoX3JhZChkZXN5bmNlZCkpICogMjAKICAgIGxvY2FsIGZha2VfeSA9IGx5ICsgbWF0aF9zaW4obWF0aF9yYWQoZGVzeW5jZWQpKSAqIDEyCiAgICAtLWNsaWVudF90cmFjZV9idWxsZXQoZW5lbXljbG9zZXN0dG9jcm9zc2hhaXIsIGV4LCBleSwgZXosIGx4X2xlZnQsIGx5X2xlZnQsIGx6LHRydWUpCiAgICBsb2NhbCBoZWFkX2lkeCwgaGVhZF9kbWcgPSBjbGllbnRfdHJhY2VfYnVsbGV0KGVudCwgZXh0cmFwb2xhdGVkX3gsIGV4dHJhcG9sYXRlZF95LCBleHRyYXBvbGF0ZWRfeiwgcmVhbF94LCByZWFsX3ksIGx6LHRydWUpCiAgICBsb2NhbCBmYWtlX2lkeCwgZmFrZV9kbWcgPSBjbGllbnRfdHJhY2VfYnVsbGV0KGVudCwgZXh0cmFwb2xhdGVkX3gsIGV4dHJhcG9sYXRlZF95LCBleHRyYXBvbGF0ZWRfeiwgZmFrZV94LCBmYWtlX3ksIGx6LHRydWUpCgogICAgbG9jYWwgcHJlZGljdGVkX2RhbWFnZSA9IDAKICAgIGxvY2FsIGRlc3luY2VkX2RhbWFnZSA9IDAKICAgIGxvY2FsIHRpbWVyID0gMAoKICAgIGlmIGhlYWRfZG1nIH49IG5pbCBhbmQgaGVhZF9kbWcgPiAwIHRoZW4KICAgICAgICBwcmVkaWN0ZWRfZGFtYWdlID0gaGVhZF9kbWcKICAgIGVsc2UKICAgICAgICBwcmVkaWN0ZWRfZGFtYWdlID0gMAogICAgZW5kCiAgICAKICAgIGlmIGZha2VfZG1nIH49IG5pbCBhbmQgZmFrZV9kbWcgPiAwIHRoZW4KICAgICAgICBkZXN5bmNlZF9kYW1hZ2UgPSBmYWtlX2RtZwogICAgZWxzZQogICAgICAgIGRlc3luY2VkX2RhbWFnZSA9IDAKICAgIGVuZAogICAgCiAgICBpZiBmbGlwX2FuZ2xlIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgLS1pZiBwcmVkaWN0ZWRfZGFtYWdlID09IGRlc3luY2VkX2RhbWFnZSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIGlmIHByZWRpY3RlZF9kYW1hZ2UgPD0gZGVzeW5jZWRfZGFtYWdlIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAoKICAgIC0tY2xpZW50LmxvZygicmVhbDogIiwgcHJlZGljdGVkX2RhbWFnZSwgIiBmYWtlOiAiLCBkZXN5bmNlZF9kYW1hZ2UsICIgY29tYjogIixjb21iKQogICAgcmV0dXJuIHByZWRpY3RlZF9kYW1hZ2Ugfj0gbmlsIGFuZCBwcmVkaWN0ZWRfZGFtYWdlID4gNTgKICAgIAplbmQKCmxvY2FsIGZ1bmN0aW9uIGFkanVzdF9hYShhYSxzaWRlKQoKaWYgc2lkZSA9PSAtOTAgdGhlbgogICAgbmV3U2lkZSA9ICJsZWZ0IgplbHNlaWYgc2lkZSA9PSA5MCB0aGVuCiAgICBuZXdTaWRlID0gInJpZ2h0IgplbmQKCmlmIHNob3QuZGlkX3Nob290ID09IHRydWUgdGhlbgogICAgaWYgc2hvdC5kZWxheSArIDAuNSA+IGdsb2JhbHMuY3VydGltZSgpIHRoZW4KICAgICAgICB1aS5zZXQoYWFfeWF3LCAiMTgwIikKICAgICAgICB1aS5zZXQoYWFfeWF3X29mZnNldCwgOSkKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlciwgIk9mZiIpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiSml0dGVyIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCAyMSkgIAogICAgICAgIC0tYXBwbHkgY2VudGVyIGppdHRlciBlbmQKICAgIGVsc2UKICAgICAgICBzaG90LmRpZF9zaG9vdCA9IGZhbHNlCiAgICBlbmQKZW5kCgoKaWYgc2hvdC5kaWRfc2hvb3QgPT0gdHJ1ZSB0aGVuIHJldHVybiBlbmQKaWYgYWEgPT0gMSB0aGVuCiAgICBpZiBuZXdTaWRlID09ICJsZWZ0IiB0aGVuCiAgICAgICAgdWkuc2V0KGFhX3lhdywgIjE4MCIpCiAgICAgICAgdWkuc2V0KGFhX3lhd19vZmZzZXQsIDEyKQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiQ2VudGVyIikKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlcl9vZmZzZXQsIDkpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiSml0dGVyIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCAtMzYpCgogICAgZWxzZWlmIG5ld1NpZGUgPT0gInJpZ2h0IiB0aGVuCiAgICAgICAgdWkuc2V0KGFhX3lhdywgIjE4MCIpCiAgICAgICAgdWkuc2V0KGFhX3lhd19vZmZzZXQsIDEwKQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiQ2VudGVyIikKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlcl9vZmZzZXQsIDMpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiSml0dGVyIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCA0MSkKCiAgICBlbmQKZW5kCgppZiBhYSA9PSAyIHRoZW4KICAgIGlmIG5ld1NpZGUgPT0gImxlZnQiIHRoZW4KICAgICAgICB1aS5zZXQoYWFfeWF3LCAiMTgwIikKICAgICAgICB1aS5zZXQoYWFfeWF3X29mZnNldCwgLTEwKQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiT2Zmc2V0IikKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlcl9vZmZzZXQsIDkpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiU3RhdGljIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCAtNDgpCgogICAgZWxzZWlmIG5ld1NpZGUgPT0gInJpZ2h0IiB0aGVuCiAgICAgICAgdWkuc2V0KGFhX3lhdywgIjE4MCIpCiAgICAgICAgdWkuc2V0KGFhX3lhd19vZmZzZXQsIDIzKQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiT2Zmc2V0IikKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlcl9vZmZzZXQsIC05KQogICAgICAgIHVpLnNldChhYV9ib2R5X3lhdywgIlN0YXRpYyIpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3X29mZnNldCwgMjYpCgogICAgZW5kCmVuZAoKCmlmIGFhID09IDMgdGhlbgogICAgaWYgbmV3U2lkZSA9PSAibGVmdCIgdGhlbgogICAgICAgIHVpLnNldChhYV95YXcsICIxODAiKQogICAgICAgIHVpLnNldChhYV95YXdfb2Zmc2V0LCA3KQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiQ2VudGVyIikKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlcl9vZmZzZXQsIDkpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiU3RhdGljIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCAyMSkKCiAgICBlbHNlaWYgbmV3U2lkZSA9PSAicmlnaHQiIHRoZW4KICAgICAgICB1aS5zZXQoYWFfeWF3LCAiMTgwIikKICAgICAgICB1aS5zZXQoYWFfeWF3X29mZnNldCwgMCkKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlciwgIkNlbnRlciIpCiAgICAgICAgdWkuc2V0KGFhX3lhd19qaXR0ZXJfb2Zmc2V0LCA1KQogICAgICAgIHVpLnNldChhYV9ib2R5X3lhdywgIlN0YXRpYyIpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3X29mZnNldCwgLTM3KQoKICAgIGVuZAplbmQKCmlmIGFhID09IDQgdGhlbgoJaWYgbmV3U2lkZSA9PSAibGVmdCIgdGhlbgogICAgICAgIHVpLnNldChhYV95YXcsICIxODAiKQogICAgICAgIHVpLnNldChhYV95YXdfb2Zmc2V0LCA5KQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiT2ZmIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXcsICJTdGF0aWMiKQogICAgICAgIHVpLnNldChhYV9ib2R5X3lhd19vZmZzZXQsIC02NikKCWVsc2VpZiBuZXdTaWRlID09ICJyaWdodCIgdGhlbgoJCXVpLnNldChhYV95YXcsICIxODAiKQogICAgICAgIHVpLnNldChhYV95YXdfb2Zmc2V0LCAtMykKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlciwgIk9mZiIpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiU3RhdGljIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCAxOSkKCWVuZAplbmQKCmlmIGFhID09IDUgdGhlbgoJaWYgbmV3U2lkZSA9PSAibGVmdCIgdGhlbgoJCXVpLnNldChhYV95YXcsICIxODAiKQogICAgICAgIHVpLnNldChhYV95YXdfb2Zmc2V0LCAtMykKICAgICAgICB1aS5zZXQoYWFfeWF3X2ppdHRlciwgIk9mZiIpCiAgICAgICAgdWkuc2V0KGFhX2JvZHlfeWF3LCAiU3RhdGljIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCAxOSkKICAgIGVsc2VpZiBuZXdTaWRlID09ICJyaWdodCIgdGhlbgogICAgICAgIHVpLnNldChhYV95YXcsICIxODAiKQogICAgICAgIHVpLnNldChhYV95YXdfb2Zmc2V0LCA5KQogICAgICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiT2ZmIikKICAgICAgICB1aS5zZXQoYWFfYm9keV95YXcsICJTdGF0aWMiKQogICAgICAgIHVpLnNldChhYV9ib2R5X3lhd19vZmZzZXQsIC02NikKCWVuZAplbmQKCmlmIGFhID09IDYgdGhlbgogICAgdWkuc2V0KGFhX3lhdywgIjE4MCIpCiAgICB1aS5zZXQoYWFfeWF3X29mZnNldCwgMykKICAgIHVpLnNldChhYV95YXdfaml0dGVyLCAiQ2VudGVyIikKICAgIHVpLnNldChhYV95YXdfaml0dGVyX29mZnNldCwgOSkKICAgIHVpLnNldChhYV9ib2R5X3lhdywgIkppdHRlciIpCiAgICB1aS5zZXQoYWFfYm9keV95YXdfb2Zmc2V0LCA0MSkKZW5kCmVuZAoKCmxvY2FsIHNhZmVfYWEgPSBmYWxzZQoKbG9jYWwgZnVuY3Rpb24gaGFuZGxlX2FudGlhaW0oKQoKCWxvY2FsIG1lID0gZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKQoKICAgIGlmIG1lID09IG5pbCB0aGVuIHJldHVybiBlbmQKCiAgICBpZiBiZXN0X2VuZW15ID09IG5pbCBvciBub3QgZW50aXR5LmlzX2FsaXZlKGJlc3RfZW5lbXkpIHRoZW4gYWRqdXN0X2FhKDYsIDApIHJldHVybiBlbmQKCglsb2NhbCBsb2NhbF9wb3MgPSB2ZWNfMyhlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKG1lLCAwKSkKCiAgICBsb2NhbCBleHRyYXBvbGF0ZWRfcG9zID0gdmVjXzMoZXh0cmFwb2xhdGVfcG9zaXRpb24obG9jYWxfcG9zLngsIGxvY2FsX3Bvcy55LCBsb2NhbF9wb3MueiwgMjQsIG1lKSkKCiAgICBsb2NhbCBlbmVteV9wb3MgPSB2ZWNfMyhlbnRpdHkuaGl0Ym94X3Bvc2l0aW9uKGJlc3RfZW5lbXksIDIpKQoKICAgIGxvY2FsIGhpdF9lbnQsIGhpdF9kbWcgPSBjbGllbnQudHJhY2VfYnVsbGV0KG1lLCBleHRyYXBvbGF0ZWRfcG9zLngsIGV4dHJhcG9sYXRlZF9wb3MueSwgZXh0cmFwb2xhdGVkX3Bvcy56LCBlbmVteV9wb3MueCwgZW5lbXlfcG9zLnksIGVuZW15X3Bvcy56KQoKICAgIGxvY2FsIHBsYXllcnMgPSBlbnRpdHkuZ2V0X3BsYXllcnModHJ1ZSkKCiAgICAtLSBDSEVFS1kgRlJFRSNTVEFORElORwogICAgaWYoYmVzdF9lbmVteSB+PSBuaWwgYW5kICNwbGF5ZXJzIH49IDApIHRoZW4KICAgICAgICByZWFsdGltZV9mcmVlc3RhbmQgPSBEb0ZyZWVzdGFuZGluZyhiZXN0X2VuZW15LCAtOTAsIDkwKQogICAgICAgIHJlYWx0aW1lX2ZyZWVzdGFuZF92MiA9IERvRWFybHlGcmVlc3RhbmRpbmcoYmVzdF9lbmVteSwgLTkwLCA5MCkKICAgICAgICAKICAgICAgICBpZiByZWFsdGltZV9mcmVlc3RhbmQgfj0gMCBhbmQgcmVhbHRpbWVfZnJlZXN0YW5kIH49IG5pbCB0aGVuCiAgICAgICAgICAgIHN0b3JlZF9mcmVlc3RhbmQgPSByZWFsdGltZV9mcmVlc3RhbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBpZiByZWFsdGltZV9mcmVlc3RhbmRfdjIgfj0gMCBhbmQgcmVhbHRpbWVfZnJlZXN0YW5kX3YyIH49IG5pbCB0aGVuCiAgICAgICAgICAgIHN0b3JlZF9mcmVlc3RhbmRfdjIgPSByZWFsdGltZV9mcmVlc3RhbmRfdjIKICAgICAgICBlbmQgCiAgICAgICAgCiAgICAgICAgaWYgKHJlYWx0aW1lX2ZyZWVzdGFuZCB+PSAwIGFuZCByZWFsdGltZV9mcmVlc3RhbmQgfj0gbmlsKSBhbmQgcmVhbHRpbWVfZnJlZXN0YW5kID09IDkwIG9yIHJlYWx0aW1lX2ZyZWVzdGFuZCA9PSAtOTAgdGhlbgogICAgICAgICAgICBhZGFwdGl2ZV9mcmVlc3RhbmQgPSByZWFsdGltZV9mcmVlc3RhbmQKICAgICAgICBlbHNlaWYgKHJlYWx0aW1lX2ZyZWVzdGFuZF92MiB+PSAwIGFuZCByZWFsdGltZV9mcmVlc3RhbmRfdjIgfj0gbmlsKSBhbmQgcmVhbHRpbWVfZnJlZXN0YW5kX3YyID09IDkwIG9yIHJlYWx0aW1lX2ZyZWVzdGFuZF92MiA9PSAtOTAgdGhlbgogICAgICAgICAgICBhZGFwdGl2ZV9mcmVlc3RhbmQgPSByZWFsdGltZV9mcmVlc3RhbmRfdjIKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBhbnRpYWltID0gdWkuZ2V0KG1lbnUuYW50aWFpbV95YXcpCiAgICAgICAgbG9jYWwgZW5lbXlfaHAgPSBlbnRpdHkuZ2V0X3Byb3AoYmVzdF9lbmVteSwgIm1fSUhlYWx0aCIpCiAgICAgICAgbG9jYWwgYWFfb3B0aW9ucyA9IHVpLmdldChtZW51LmFudGlhaW1fb3B0aW9ucykKCiAgICAgICAgaWYgYW50aWFpbSA9PSAiRGFuZ2Vyb3VzIiBhbmQgc2FmZV9hYSA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgIGlmIGFkYXB0aXZlX2ZyZWVzdGFuZCA9PSAtOTAgdGhlbgogICAgICAgICAgICAgICAgaWYgaGl0X2VudCA9PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGFkanVzdF9hYSgxLCAtOTApCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYWRqdXN0X2FhKDIsIC05MCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgYWRhcHRpdmVfZnJlZXN0YW5kID09IDkwIHRoZW4KICAgICAgICAgICAgICAgIGlmIGhpdF9lbnQgPT0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICBhZGp1c3RfYWEoMSwgOTApCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYWRqdXN0X2FhKDIsIDkwKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBhYV9vcHRpb25zID09ICJFbmVteSBMZXRoYWwiIHRoZW4KICAgICAgICAgICAgaWYgZW5lbXlfaHAgPCA1MCB0aGVuCiAgICAgICAgICAgICAgICBzYWZlX2FhID0gdHJ1ZSAKICAgICAgICAgICAgICAgIGlmIGFkYXB0aXZlX2ZyZWVzdGFuZCA9PSAtOTAgdGhlbgogICAgICAgICAgICAgICAgICAgIGFkanVzdF9hYSgzLCAtOTApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGFkYXB0aXZlX2ZyZWVzdGFuZCA9PSA5MCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYWRqdXN0X2FhKDMsIDkwKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgc2FmZV9hYSA9IGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoJCQoJCWlmIGFudGlhaW0gPT0gIkh5YnJpZCIgdGhlbgoJCQlpZiBhZGFwdGl2ZV9mcmVlc3RhbmQgPT0gLTkwIHRoZW4KCQkJCWlmIGhpdF9lbnQgPT0gbmlsIHRoZW4KCQkJCQlhZGp1c3RfYWEoNSwgLTkwKQoJCQkJZWxzZQoJCQkJCWFkanVzdF9hYSg0LCAtOTApCgkJCQllbmQKCQkJZW5kCgkJaWYgYWRhcHRpdmVfZnJlZXN0YW5kID09IDkwIHRoZW4KCQkJaWYgaGl0X2VudCA9PSBuaWwgdGhlbgoJCQkJYWRqdXN0X2FhKDUsIDkwKQoJCQllbHNlCgkJCQlhZGp1c3RfYWEoNCwgOTApCgkJCWVuZAoJCWVuZAoJZW5kCiAgICBlbmQKZW5kCgoKCmxvY2FsIGZ1bmN0aW9uIGFpbV9maXJlKGUpCgpzaG90LmRpZF9zaG9vdCA9IHRydWUKc2hvdC5kZWxheSA9IGdsb2JhbHMuY3VydGltZSgpCgplbmQKCgpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCdhaW1fZmlyZScsIGZ1bmN0aW9uKGUpCgogICAgYWltX2ZpcmUoZSkKCmVuZCkKCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJidWxsZXRfaW1wYWN0IiwgZnVuY3Rpb24oZSkKCiAgICAgICAgYnJ1dGUuaW1wYWN0KGUpCgogICAgZW5kKQoKICAgIGNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInBsYXllcl9kZWF0aCIsIGZ1bmN0aW9uKGUpCgogICAgICAgIGJydXRlLmRlYXRoKGUpCgogICAgZW5kKQoKCiAgICBjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJydW5fY29tbWFuZCIsIGZ1bmN0aW9uKCkKCiAgICAgICAgZ2V0X2Jlc3RfZW5lbXkoKQogICAgICAgIGhhbmRsZV9hbnRpYWltKCkKCiAgICBlbmQpCiA="

    local decoded_script = base64.decode(base64_string)

    local script, err = loadstring(decoded_script)
    if script then
        script()  
    else
        print("Error loading script: " .. (err or "Unknown error"))
    end
else
    return
end
